diff -urNp -x '*.orig' php-5.5.38.org/ext/mysqli/mysqli.c php-5.5.38/ext/mysqli/mysqli.c
--- php-5.5.38.org/ext/mysqli/mysqli.c	2016-07-20 10:41:48.000000000 +0200
+++ php-5.5.38/ext/mysqli/mysqli.c	2021-08-23 23:03:01.249944392 +0200
@@ -570,6 +570,7 @@ PHP_INI_BEGIN()
 #else
 	STD_PHP_INI_ENTRY("mysqli.default_socket",			NULL,	PHP_INI_ALL,		OnUpdateStringUnempty,	default_socket,	zend_mysqli_globals,		mysqli_globals)
 #endif
+	STD_PHP_INI_ENTRY("mysqli.connect_charset",			NULL,	PHP_INI_ALL,		OnUpdateString,		connect_charset,	zend_mysqli_globals,		mysqli_globals)
 	STD_PHP_INI_BOOLEAN("mysqli.reconnect",				"0",	PHP_INI_SYSTEM,		OnUpdateLong,		reconnect,			zend_mysqli_globals,		mysqli_globals)
 	STD_PHP_INI_BOOLEAN("mysqli.allow_local_infile",	"1",	PHP_INI_SYSTEM,		OnUpdateLong,		allow_local_infile,	zend_mysqli_globals,		mysqli_globals)
 PHP_INI_END()
@@ -591,6 +592,7 @@ static PHP_GINIT_FUNCTION(mysqli)
 	mysqli_globals->default_user = NULL;
 	mysqli_globals->default_pw = NULL;
 	mysqli_globals->default_socket = NULL;
+	mysqli_globals->connect_charset = NULL;
 	mysqli_globals->reconnect = 0;
 	mysqli_globals->report_mode = 0;
 	mysqli_globals->report_ht = 0;
diff -urNp -x '*.orig' php-5.5.38.org/ext/mysqli/mysqli_nonapi.c php-5.5.38/ext/mysqli/mysqli_nonapi.c
--- php-5.5.38.org/ext/mysqli/mysqli_nonapi.c	2016-07-20 10:41:48.000000000 +0200
+++ php-5.5.38/ext/mysqli/mysqli_nonapi.c	2021-08-23 23:03:01.249944392 +0200
@@ -62,7 +62,7 @@ void mysqli_common_connect(INTERNAL_FUNC
 	MY_MYSQL			*mysql = NULL;
 	MYSQLI_RESOURCE		*mysqli_resource = NULL;
 	zval				*object = getThis();
-	char				*hostname = NULL, *username=NULL, *passwd=NULL, *dbname=NULL, *socket=NULL;
+	char				*hostname = NULL, *username=NULL, *passwd=NULL, *dbname=NULL, *socket=NULL, *connect_charset=NULL;
 	int					hostname_len = 0, username_len = 0, passwd_len = 0, dbname_len = 0, socket_len = 0;
 	zend_bool			persistent = FALSE;
 	long				port = 0, flags = 0;
@@ -233,6 +233,12 @@ void mysqli_common_connect(INTERNAL_FUNC
 	}
 #endif
 
+	connect_charset = MyG(connect_charset);
+
+	if (connect_charset != NULL) {
+		mysql_options(mysql->mysql, MYSQL_SET_CHARSET_NAME, connect_charset);
+	}
+
 #if !defined(MYSQLI_USE_MYSQLND)
 	/* BC for prior to bug fix #53425 */
 	flags |= CLIENT_MULTI_RESULTS;
diff -urNp -x '*.orig' php-5.5.38.org/ext/mysqli/php_mysqli_structs.h php-5.5.38/ext/mysqli/php_mysqli_structs.h
--- php-5.5.38.org/ext/mysqli/php_mysqli_structs.h	2016-07-20 10:41:48.000000000 +0200
+++ php-5.5.38/ext/mysqli/php_mysqli_structs.h	2021-08-23 23:03:01.249944392 +0200
@@ -329,6 +329,7 @@ ZEND_BEGIN_MODULE_GLOBALS(mysqli)
 	char			*default_user;
 	char			*default_socket;
 	char			*default_pw;
+	char			*connect_charset;
 	long			reconnect;
 	long			allow_local_infile;
 	long			strict;
