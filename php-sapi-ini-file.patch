--- php-5.0.4/main/php_ini.c.orig	2004-09-17 04:48:47.000000000 +0200
+++ php-5.0.4/main/php_ini.c	2005-04-04 23:07:48.461211584 +0200
@@ -430,6 +430,24 @@
 				}
 			}
 		}
+		/* Search (global) php.ini file in search path */
+		if (!fh.handle.fp) {
+			fh.handle.fp = php_fopen_with_path("php.ini", "r", php_ini_search_path, &php_ini_opened_path TSRMLS_CC);
+			if (fh.handle.fp) {
+				fh.filename = php_ini_opened_path;
+				PG(safe_mode) = safe_mode_state;
+				PG(open_basedir) = open_basedir;
+				fh.type = ZEND_HANDLE_FP;
+				zend_parse_ini_file(&fh, 1, php_config_ini_parser_cb, &extension_lists);
+				safe_mode_state = PG(safe_mode);
+				open_basedir = PG(open_basedir);
+				PG(safe_mode) = 0;
+				PG(open_basedir) = NULL;
+				fh.handle.fp = NULL;
+				efree(php_ini_opened_path);
+				fh.filename = php_ini_opened_path = NULL;
+			}
+		}
 		/* Search php-%sapi-module-name%.ini file in search path */
 		if (!fh.handle.fp) {
 			const char *fmt = "php-%s.ini";
@@ -441,13 +459,6 @@
 				fh.filename = php_ini_opened_path;
 			}
 		}
-		/* Search php.ini file in search path */
-		if (!fh.handle.fp) {
-			fh.handle.fp = php_fopen_with_path("php.ini", "r", php_ini_search_path, &php_ini_opened_path TSRMLS_CC);
-			if (fh.handle.fp) {
-				fh.filename = php_ini_opened_path;
-			}
-		}
 	}
 
 	if (free_ini_search_path) {
