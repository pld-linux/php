--- php-5.3.0/main/php_ini.c.org	2009-07-06 17:32:30.309904482 +0200
+++ php-5.3.0/main/php_ini.c	2009-07-06 17:36:45.529879052 +0200
@@ -620,12 +620,14 @@
 		zend_llist scanned_ini_list;
 		zend_llist_element *element;
 		int l, total_l = 0;
+		const char *fmt = "%s:" PHP_CONFIG_FILE_PATH "/%s.d";
 
 		/* List of found ini files */
 		zend_llist_init(&scanned_ini_list, sizeof(char *), (llist_dtor_func_t) free_estring, 1);
 		
 		/* Split by paths_separator and load ini-files from all paths */
-		path_copy = estrdup(php_ini_scanned_path);
+		path_copy = emalloc(strlen(php_ini_scanned_path) + strlen(fmt) + strlen(sapi_module.name));
+		sprintf(path_copy, fmt, php_ini_scanned_path, sapi_module.name);
 		ini_path  = php_strtok_r(path_copy, paths_separator, &last);
 
 		while (ini_path != NULL) {
